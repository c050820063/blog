---
title: 微信登录鉴权
date: 2021-06-24 11:47:36
tags:
---

### 公众号鉴权
<!-- more -->
- 非静默授权
1. 调用微信api获取用户授权code，即用户点击确认登录后返回给页面的一个值：https://open.weixin.qq.com/connect/oauth2/authorize?appid=APPID&redirect_uri=REDIRECT_URI&response_type=code&scope=SCOPE&state=STATE#wechat_redirect

2. 调用微信api返回的code换取网页授权凭证access_token：
获取code后，请求以下链接获取access_token： https://api.weixin.qq.com/sns/oauth2/access_token?appid=APPID&secret=SECRET&code=CODE&grant_type=authorization_code
其中的appid与secert是微信服务号或订阅号的基本信息中内容，返回值是一个json字符串，我们只要获取其中的用户唯一标识openid与授权凭证accesstoken就够了。

3. 刷新access_token（如果需要）
由于access_token拥有较短的有效期，当access_token超时后，可以使用refresh_token进行刷新，refresh_token有效期为30天，当refresh_token失效之后，需要用户重新授权。
请求方法：获取第二步的refresh_token后，请求以下链接获取access_token：
https://api.weixin.qq.com/sns/oauth2/refresh_token?appid=APPID&grant_type=refresh_token&refresh_token=REFRESH_TOKEN

4. 拉取用户信息（需scope为 snsapi_userinfo）

- 静默授权
1. 第一步获取code的时候scope的值为snsapi_base

2. 第二部获取到openid之后授权过程到此结束。
在这里提供静默授权的一个作用，就是可以根据用户的唯一标识openid来判断用户是否关注了本微信公众号，在获取openid之后在进行两步操作即可。

3. 调用微信api获取微信的通用凭证accesstoken



